<!-- ✏️ Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form class="modal-content" method="POST" id="edit-product-form">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title"><strong>Edit Product</strong></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          {% include "pages/includes/product_form.html" %}
          <input type="hidden" name="product_id" id="edit-product-id">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>

<script>
    // ✏️ Pre-fill Edit Modal
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const raw = btn.getAttribute('data-product');
      let data = {};
      try { data = JSON.parse(raw); } catch (e) { console.error('Invalid product data', e); }

      // Set form action
      const form = document.getElementById('edit-product-form');
      form.action = `/inventory/edit/${data.product_id}/`;

      // Fill each field
      for (const [key, val] of Object.entries(data)) {
        const field = form.querySelector(`[name="${key}"]`);
        if (field) field.value = val ?? '';
      }

      // Select dropdowns
      if (data.category) form.querySelector('[name="category"]').value = data.category;
      if (data.unit) form.querySelector('[name="unit"]').value = data.unit;
    });
  });
</script>
